@page "{handler?}"

@model QuickieLube.Razor.Pages.Vehicles.VehicleSearchModel
@{
    ViewData["Title"] = "Vehicle Search";
}

<div>
    <div class="d-flex justify-content-center"><h3>Vehicle Search</h3></div>
    <div class="">
        <div class="row d-flex justify-content-center align-items-center">
            <div class="col-md-6 p-xl-3">
                <div class="form">

                    <form method="get">
                        <button type="submit" class="fa fa-search"></button>
                        <input type="text" asp-for="SearchParams" class="form-control form-input shadow p-3 mb-5 bg-body rounded" placeholder="Search by vehicle id, name, vin">
                    </form>

                    <form method="post" asp-page-handler="ClearSearchField">
                        <span class="left-pan">
                            <button type="submit" class="fa fa-times-circle"></button>
                        </span>
                    </form>

                </div>
            </div>
            <table class="table imagetable table-responsive p-xl-3" id="tblVehicleSearch">
                <thead>
                    <tr>
                        <th>Vehicle ID</th>
                        <th>Name</th>
                        <th>Vehicle</th>
                        <th>VIN</th>
                        <th>Fleet</th>
                        <th>Last Service</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        <tr>
                            <td>@vehicle.Id</td>
                            <td>@vehicle.Name</td>
                            <td>@vehicle.Description</td>
                            <td>@vehicle.VIN</td>
                            <td>@vehicle.Fleet</td>
                            <td>@vehicle.LastService.ToString("yyyy-MM-dd")</td>
                            <td><a id=@vehicle.Id class="btn btn-primary" asp-page="/Vehicles/Edit" asp-route-id="@vehicle.Id">Edit</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts{
    <script>

        $("#tblVehicleSearch tr").click(function () {
            var selected = $(this).hasClass("highlight");
            $("#tblVehicleSearch tr").removeClass("highlight");
            if (!selected) {
                $(this).addClass("highlight");
                var btnEditSelection = $(this).find("a").attr('id');
                $('#' + btnEditSelection).focus();
            }
        });

        $('#tblVehicleSearch tr').dblclick(function () {
            debugger;
            var btnEditSelection = $(this).find("a").attr('id');
            $('#' + btnEditSelection).focus();
            var e = jQuery.Event("keydown", { keyCode: 13 });
            $("#" + btnEditSelection).trigger(e);
        })
    </script>

}
